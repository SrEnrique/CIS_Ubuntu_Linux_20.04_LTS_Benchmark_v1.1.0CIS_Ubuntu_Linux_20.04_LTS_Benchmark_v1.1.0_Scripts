#!/bin/bash

# Create file is a function for create new file
# Require - name file

	RED='\033[0;31m'
	GREEN='\033[0;32m'
	YELLOW='\033[1;33m'
	NC='\033[0m'

function fail(){
    printf '%s\n' "$1" >&2 #Send message to stderr
    exit "${2-1}"
}


function new_file(){
    
    file_name=$1
    if [ -f "$file_name" ]; then
        echo -e "${RED}Error: ${NC}"
        fail "file $file_name exists."
    fi

    touch $file_name || fail "Error, file no created"
}

function main(){
    echo "Create File"
    new_file $1
    echo -e "File $1.... ${GREEN}[Created]${NC}"

    # Add shebang
    if [ "$2" != "" ]; then
        echo $2 >> $1
        echo "" >> $1
        echo -e "Add shebang ${YELLOW}[Injected]${NC}"
    fi
    
    
    echo "# Autor: Luis Enrique Gastelum" >> $1
    echo -e "Add author ${YELLOW}[Injected]${NC}"

    echo "# ** Autogenerated **" >> $1
    echo -e "Add banner ${YELLOW}[Injected]${NC}"



}


NewFileName=""
Shebang=""

while getopts "f:s:" FLAG
do
    case "${FLAG}" in
        f) 
            NewFileName=${OPTARG}
        ;;
        s)
            case "${OPTARG}" in
                "bash")
                    #
                    Shebang="#!/bin/bash"
                ;;
                "sh")
                    #
                    Shebang="#!/bin/sh"
                ;;
                "ruby")
                    #
                    Shebang="#!/bin/ruby"
                ;;
                *)
                    fail "No supported shebang ${OPTARG}, use bash | ruby | sh "
                ;;
            esac
        ;;
    esac
done

if [ "$NewFileName" = "" ]; then
    fail "-f file name is required"
fi


main $NewFileName $Shebang